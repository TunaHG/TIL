# ORDER BY 절

## ORDER BY 정렬

* SQL 문장으로 조회된 데이터들을 다양한 목적에 맞게 특정 칼럼을 기준으로 정렬하여 출력하는데 사용

* 칼럼명 대신에 SELECT 절에서 사용한 ALIAS 명이나 칼럼 순서를 나타내는 정수도 사용 가능

* SQL 문장의 제일 마지막에 위치

* 표현식

  ```SQL
  SELECT 칼럼명 [ALIAS 명]
  FROM 테이블명
  [WHERE 조건식]
  [GROUP BY 칼럼이나 표현식]
  [HAVING 그룹조건식]
  [ORDER BY 칼럼이나 표현식 [ASC | DESC]];
  ```

  * ASC : 오름차순(기본값이므로 생략가능) / DESC : 내림차순

* 특징

  * 기본적인 정렬 순서는 오름차순
  * 숫자형 데이터 타입은 오름차순으로 정렬했을 경우에 가장 작은 값부터 출력
  * 날짜형 데이터 타입은 오름차순으로 정렬했을 경우 날짜 값이 가장 빠른 값이 먼저 출력
    * 1월1일이 11월 1일보다 먼저 출력
  * Oracle에서는 NULL 값을 가장 큰 값으로 간주하여 오름차순으로 정렬했을 경우에는 가장 마지막에, 내림차순으로 정렬햇을 경우에는 가장 먼저 위치
  * SQL Server에서는 NULL 값을 가장 작은 값으로 간주하여 Oracle과 반대로 위치

## SELECT 문장 실행 순서

1. 발췌 대상 테이블을 참조 (FROM)
2. 발췌 대상 데이터가 아닌 것은 제거 (WHERE)
3. 행들을 소그룹화 (GROUP BY)
4. 그룹핑된 값의 조건에 맞는 것만을 출력 (HAVING)
5. 데이터 값을 출력/계산 (SELECT)
6. 데이터를 정렬 (ORDER BY)

* 이 순서는 옵티마이저가 SQL 문장의 SYNTAX, SEMANTIC 에러를 점검하는 순서이기도 함
* 관계형 데이터베이스가 데이터를 메모리에 올릴 때 행 단위로 모든 칼럼을 가져오게 되므로
  ORDER BY 절에서 메모리에 올라와 있는 다른 칼럼의 데이터를 사용할 수 있음
  * 서브쿼리의 SELECT 절에서 선택되지 않은 칼럼들은 계속 유지되는 것이 아니라 서브쿼리 범위를 벗어나면 사용할 수 없게 됨
  * GROUP BY 절을 사용하게 되면 그룹핑 기준에 사용된 칼럼과 집계 함수에 사용될 수 있는 숫자형 데이터 칼럼들의 집합을 새로 만드는데, 개별 데이터는 필요 없으므로 저장하지 않음
    * GROUP BY 이후 수행 절인 SELECT 절이나 ORDER BY 절에서 개별 데이터를 사용하는 경우 에러가 발생

## Top N 쿼리

### ROWNUM

* Oracle의 경우 데이터의 일부가 먼저 추출된 후 데이터에 대한 정렬 작업이 일어나므로 주의

  * ORDER BY 절은 결과 집합을 결정하는데 관여하지 않음

* 인라인 뷰를 사용하여 추출하고자 하는 집합을 정렬한 후 ROWNUM을 적용시킴으로써 진행

  ```SQL
  SELECT ENAME, SAL
  FROM (SELECT ENAME, SAL
        FROM EMP
        ORDER BY SAL DESC)
  WHERE ROWNUM < 4;
  ```

### TOP()

* SQL Server의 경우 TOP 조건을 사용하게 되면 별도 처리 없이 관련 ORDER BY 절의 데이터 정렬 후 원하는 일부 데이터만 쉽게 출력할 수 있음

* 표현식

  ```SQL
  TOP (Expression) [PERCENT] [WITH TIES]
  ```

* 결과 집합으로 반환되는 행 수를 제한 가능

* `WITH TIES`

  * ORDER BY 절의 조건 기준으로 TOP N의 마지막 행으로 표시되는 추가 행의 데이터가 같을 경우 N+ 동일 정렬 순서 데이터를 추가 반환하도록 지정하는 옵션